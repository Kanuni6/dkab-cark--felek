<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bilgi YarÄ±ÅŸmasÄ±</title>
  <style>
    /* ------------------------------------- */
    /* GLOBAL VE GENEL DÃœZEN AYARLARI        */
    /* ------------------------------------- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #f0f4ff, #e6ffe9);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: #1a202c;
      font-size: 1.1rem; /* MasaÃ¼stÃ¼ iÃ§in genel font boyutunu artÄ±rdÄ±k */
    }

    /* TÃ¼m Ekran KapsayÄ±cÄ±larÄ± */
    .giris-ekrani,
    .tam-ekran-kapsayici,
    .oyun-bitti-ekran {
      background: #ffffff;
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
      width: 100%;
      max-width: 480px; /* GiriÅŸ ekranÄ± iÃ§in varsayÄ±lan maks geniÅŸlik */
    }

    .tam-ekran-kapsayici {
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 800px; /* Ã‡ark ve soru ekranlarÄ± iÃ§in geniÅŸletilmiÅŸ maks geniÅŸlik */
      margin: auto; /* Ortalamak iÃ§in */
    }

    .oyun-bitti-ekran {
      max-width: 720px; /* Oyun bitti ekranÄ± iÃ§in maks geniÅŸlik */
      text-align: center;
    }


    /* Genel BaÅŸlÄ±k Stili */
    .baslik {
      font-size: 2rem; /* BaÅŸlÄ±k font boyutunu artÄ±rdÄ±k */
      margin-bottom: 28px;
      text-align: center;
      color: #2b6cb0;
    }

    /* Genel Buton Stili (Basla/Oyunu Bitir/Ana Ekrana DÃ¶n) */
    .basla-butonu,
    .ana-butonu {
      background-color: #4299e1; /* Ana buton rengi */
      color: white;
      border: none;
      padding: 14px 24px;
      font-size: 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 15px;
      transition: background-color 0.3s;
      width: auto; /* Ä°Ã§eriÄŸe gÃ¶re geniÅŸle */
    }

    .basla-butonu:hover,
    .ana-butonu:hover {
      background-color: #3182ce;
    }

    .ana-butonu {
        background-color: #319795; /* Ã–zel renk */
        margin-top: 30px; /* Margin ekledik */
        padding: 14px 28px; /* Daha geniÅŸ padding */
    }
    .ana-butonu:hover {
        background-color: #2c7a7b;
    }


    /* ------------------------------------- */
    /* GÄ°RÄ°Å EKRANI AYARLARI                 */
    /* ------------------------------------- */
    .grup-formu {
      display: flex;
      flex-direction: column;
      gap: 18px; /* BoÅŸluklarÄ± artÄ±rdÄ±k */
    }

    .grup-formu label {
      display: flex;
      flex-direction: column;
      font-weight: 500;
      font-size: 1.1rem; /* Label font boyutunu artÄ±rdÄ±k */
      color: #2d3748;
    }

    .grup-formu input {
      margin-top: 8px;
      padding: 12px 16px;
      font-size: 1.1rem; /* Input font boyutunu artÄ±rdÄ±k */
      border: 1px solid #cbd5e0;
      border-radius: 8px;
      transition: border-color 0.3s;
    }

    .grup-formu input:focus {
      border-color: #4299e1;
      outline: none;
    }

    .grup-formu select {
      margin-top: 8px;
      padding: 14px 18px; /* SeÃ§ici padding ve font boyutunu artÄ±rdÄ±k */
      font-size: 1.2rem;
      border: 1px solid #cbd5e0;
      border-radius: 8px;
      transition: border-color 0.3s;
      appearance: none;
      background-color: #f8f8f8;
      cursor: pointer;
    }

    .grup-formu select:focus {
      border-color: #4299e1;
      outline: none;
    }


    /* ------------------------------------- */
    /* Ã‡ARK EKRANI AYARLARI                  */
    /* ------------------------------------- */
    .ayet {
      font-size: 1.2rem; /* Ayet font boyutunu artÄ±rdÄ±k */
      font-style: italic;
      background: #d9f7f0;
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 25px;
      box-shadow: 0 0 8px rgba(0,0,0,0.05);
      width: 100%; /* KapsayÄ±cÄ±nÄ±n geniÅŸliÄŸi kadar olsun */
      text-align: center;
    }

    .canvas-container {
      position: relative;
      width: 550px; /* Ã‡ark boyutunu daha da bÃ¼yÃ¼ttÃ¼k */
      height: 550px; /* Ã‡ark boyutunu daha da bÃ¼yÃ¼ttÃ¼k */
    }

    canvas {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.12);
    }

    /* OK Ä°ÅARETÄ° */
    #okIsareti {
      --ok-yatay-boyut: 10px; /* Yatay boyut iÃ§in deÄŸiÅŸken */
      --ok-dikey-boyut: 25px; /* Dikey boyut iÃ§in deÄŸiÅŸken */

      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%); /* Rotate kaldÄ±rÄ±ldÄ±, okun ucu aÅŸaÄŸÄ± bakacak */
      width: 0;
      height: 0;
      border-left: var(--ok-yatay-boyut) solid transparent;
      border-right: var(--ok-yatay-boyut) solid transparent;
      border-top: var(--ok-dikey-boyut) solid #e53e3e;
      transition: transform 0.2s ease;
      z-index: 10;
    }

    @keyframes okTitrese {
      0%   { transform: translateX(-50%) scale(1); filter: brightness(1); }
      50%  { transform: translateX(-50%) scale(1.15); filter: brightness(1.7); }
      100% { transform: translateX(-50%) scale(1); filter: brightness(1); }
    }

    #okIsareti.titre {
      animation: okTitrese 0.4s ease;
    }

    /* Ã‡evir Butonu */
    .canvas-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2;
      width: 120px; /* BurayÄ± bÃ¼yÃ¼ttÃ¼k */
      height: 120px; /* BurayÄ± bÃ¼yÃ¼ttÃ¼k */
      line-height: 120px; /* Height ile aynÄ± yapÄ±n */
      font-size: 1.4rem; /* Ã‡evir butonu font boyutunu artÄ±rdÄ±k */
      text-align: center;
      border-radius: 50%;
      background-color: #319795;
      color: white;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(0,0,0,0.18);
      transition: background-color 0.3s;
    }

    .canvas-button:hover {
      background-color: #2c7a7b;
    }

    /* Grup Tablosu (Ã‡ark ekranÄ± altÄ±nda) */
    .grup-tablosu {
      display: flex;
      flex-wrap: wrap; /* Gerekirse alt satÄ±ra geÃ§sin */
      gap: 25px; /* BoÅŸluklarÄ± artÄ±rdÄ±k */
      margin-top: 35px;
      justify-content: center; /* GruplarÄ± ortala */
      width: 100%; /* KapsayÄ±cÄ±nÄ±n tam geniÅŸliÄŸini kullan */
    }

    .grup {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: white;
      border-radius: 10px;
      padding: 12px 16px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.12);
      min-width: 120px; /* Minimum geniÅŸliÄŸi artÄ±rdÄ±k, tek grup iÃ§in daha iyi gÃ¶rÃ¼nebilir */
      flex-basis: auto; /* Flex Ã¶ÄŸelerinin varsayÄ±lan boyutlandÄ±rmasÄ± */
    }

    .grup .isim {
      font-weight: bold;
      font-size: 1.1rem; /* Grup ismi font boyutunu artÄ±rdÄ±k */
      margin-bottom: 6px;
    }

    .grup .puan {
      font-size: 1.6rem; /* Puan font boyutunu artÄ±rdÄ±k */
      color: #319795;
    }

    .aktif-grup-box { /* Ã‡ark ekranÄ±ndaki aktif grup gÃ¶stergesi */
      font-size: 1.3rem; /* Aktif grup font boyutunu artÄ±rdÄ±k */
      font-weight: bold;
      color: #2c7a7b;
      margin-bottom: 25px;
      margin-top: 20px; /* Biraz boÅŸluk */
    }


    /* ------------------------------------- */
    /* SORU SAYFASI AYARLARI                 */
    /* ------------------------------------- */
    .ust-bilgi-kutusu {
      display: flex;
      justify-content: space-between;
      width: 100%;
      padding: 12px 0;
      margin-bottom: 25px;
      font-size: 1.2rem; /* Ãœst bilgi font boyutunu artÄ±rdÄ±k */
      font-weight: 500;
      color: #2d3748;
    }

    .ust-bilgi {
      padding: 10px 15px;
      background: #e6fffa;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    }

    .soru-kutusu {
      background: #ffffff;
      padding: 35px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
      width: 100%;
      max-width: 800px; /* Maksimum geniÅŸliÄŸi artÄ±rdÄ±k */
      min-height: 280px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      color: #2d3748;
    }

    .soru-metin {
      font-size: 1.5rem; /* Soru metin font boyutunu artÄ±rdÄ±k */
      margin-bottom: 30px;
    }

    .secenek-kutusu {
      display: flex;
      flex-direction: column;
      gap: 15px; /* BoÅŸluklarÄ± artÄ±rdÄ±k */
      margin-top: 15px;
      width: 100%;
    }

    .secenek-btn {
      background: #ebf8ff;
      border: 1px solid #90cdf4;
      border-radius: 10px;
      padding: 14px 20px;
      font-size: 1.1rem; /* SeÃ§enek butonu font boyutunu artÄ±rdÄ±k */
      cursor: pointer;
      text-align: left;
      transition: background 0.2s;
    }

    .secenek-btn:hover:not(.disabled):not(.selected-option) {
      background: #bee3f8;
    }

    /* SonuÃ§ kutularÄ± (DoÄŸru/YanlÄ±ÅŸ) */
    .sonuc-kutusu {
      padding: 25px;
      border-radius: 10px;
      margin-top: 25px;
      text-align: center;
      border-left: 10px solid; /* KalÄ±nlaÅŸtÄ±rdÄ±k */
      width: 100%;
    }

    .sonuc-kutusu.dogru {
        border-color: #48bb78;
        background-color: #f0fff4;
    }

    .sonuc-kutusu.yanlis {
        border-color: #f56565;
        background-color: #fff5f5;
    }

    .sonuc-kutusu h3 {
      margin-bottom: 12px;
      font-size: 1.5rem; /* SonuÃ§ baÅŸlÄ±k font boyutunu artÄ±rdÄ±k */
    }

    .sonuc-kutusu p {
      font-size: 1.1rem; /* SonuÃ§ aÃ§Ä±klama font boyutunu artÄ±rdÄ±k */
      color: #4a5568;
    }

    /* Joker Mesaj Kutusu */
    .message-box {
        margin-top: 20px;
        padding: 15px;
        background-color: #fff3cd;
        border: 1px solid #ffeeba;
        border-radius: 8px;
        color: #856404;
        font-size: 1.1rem;
        text-align: center;
        width: 100%;
        max-width: 600px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    /* Joker ButonlarÄ± */
    .joker-button-container {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 25px;
        width: 100%;
    }

    .joker-button {
        background-color: #63b3ed;
        color: white;
        border: none;
        padding: 12px 20px;
        font-size: 1rem;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .joker-button:hover:not(:disabled) {
        background-color: #4299e1;
    }

    .joker-button:disabled {
        background-color: #cbd5e0;
        cursor: not-allowed;
    }

    /* SeÃ§enek Butonu Renkleri (DoÄŸru/YanlÄ±ÅŸ/SeÃ§ili) */
    .secenek-btn.correct-answer {
      background-color: #c6f6d5; /* Green for correct answer */
      border-color: #68d391;
      font-weight: bold;
    }

    .secenek-btn.incorrect-answer {
      background-color: #fed7d7; /* Red for incorrect answer */
      border-color: #fc8181;
      font-weight: bold;
    }

    .secenek-btn.selected-option {
        background-color: #aed6f1; /* Light blue for selected (for Ã‡ift Cevap) */
        border-color: #6bb0e6;
    }

    .secenek-btn.disabled {
      background-color: #e2e8f0;
      color: #a0aec0;
      border-color: #cbd5e0;
      cursor: not-allowed;
    }


    /* ------------------------------------- */
    /* OYUN BÄ°TTÄ° EKRANI AYARLARI            */
    /* ------------------------------------- */
    .puan-tablosu {
      width: 90%; /* GeniÅŸliÄŸi artÄ±rdÄ±k */
      margin: 25px auto 35px;
      border-collapse: collapse;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      border-radius: 8px;
      overflow: hidden;
    }

    .puan-tablosu th, .puan-tablosu td {
      padding: 14px 18px;
      border: 1px solid #ebf8ff;
      text-align: left;
      font-size: 1.1rem; /* Tablo font boyutunu artÄ±rdÄ±k */
    }

    .puan-tablosu thead {
      background-color: #4299e1;
      color: white;
    }

    .puan-tablosu tbody tr:nth-child(even) {
      background-color: #f7fafc;
    }

    .puan-tablosu tbody tr:hover {
      background-color: #ebf8ff;
    }


    /* ------------------------------------- */
    /* RESPONSIVE AYARLAR                    */
    /* ------------------------------------- */
    @media (max-width: 768px) { /* Tablet boyutlarÄ± iÃ§in orta nokta ekledik */
      body {
        font-size: 1rem; /* Mobil ve tablet iÃ§in varsayÄ±lan font boyutu */
      }
      .giris-ekrani, .oyun-bitti-ekran, .tam-ekran-kapsayici {
        padding: 25px;
        max-width: 90%; /* Daha esnek max-width */
      }
      .baslik {
        font-size: 1.8rem;
      }
      .grup-formu input, .grup-formu select {
        font-size: 1rem;
        padding: 10px 14px;
      }
      .basla-butonu {
        font-size: 1.1rem;
        padding: 12px 20px;
      }
      .canvas-container {
        width: 550px; /* Tablet iÃ§in Ã§ark boyutunu ayarladÄ±k */
        height: 550px;
      }
      /* OK Ä°ÅARETÄ° DÃœZELTMESÄ° (Tablet) */
      #okIsareti {
        --ok-yatay-boyut: 10px;
        --ok-dikey-boyut: 25px;
      }
      @keyframes okTitrese { /* OK titremesi boyutunu kÃ¼Ã§Ã¼lt */
        0%   { transform: translateX(-50%) scale(1); filter: brightness(1); }
        50%  { transform: translateX(-50%) scale(1.1); filter: brightness(1.5); }
        100% { transform: translateX(-50%) scale(1); filter: brightness(1); }
      }
      .canvas-button {
        width: 120px; /* Tablet iÃ§in Ã§evir butonu */
        height: 120px;
        line-height: 120px;
        font-size: 1.6rem;
      }
      .grup-tablosu {
        gap: 15px;
      }
      .grup {
        min-width: 100px;
        padding: 8px 12px;
      }
      .grup .isim {
        font-size: 0.95rem;
      }
      .grup .puan {
        font-size: 1.3rem;
      }
      .aktif-grup-box {
        font-size: 1.1rem;
      }
      .ust-bilgi-kutusu {
        font-size: 1rem;
        padding: 8px 0;
      }
      .ust-bilgi {
        padding: 6px 10px;
      }
      .soru-kutusu {
        padding: 25px;
        min-height: 250px;
        max-width: 90%;
      }
      .soru-metin {
        font-size: 1.2rem;
      }
      .secenek-btn {
        padding: 10px 14px;
        font-size: 1rem;
      }
      .sonuc-kutusu {
        padding: 20px;
        border-left: 8px solid;
      }
      .sonuc-kutusu h3 {
        font-size: 1.3rem;
      }
      .sonuc-kutusu p {
        font-size: 1rem;
      }
      .joker-button-container {
        gap: 10px;
      }
      .joker-button {
        padding: 10px 15px;
        font-size: 0.9rem;
      }
      .puan-tablosu th, .puan-tablosu td {
        padding: 10px 12px;
        font-size: 1rem;
      }
      .ana-butonu {
        font-size: 1.1rem;
        padding: 12px 22px;
      }
    }

    @media (max-width: 480px) { /* Telefon boyutlarÄ± iÃ§in daha spesifik ayarlamalar */
      body {
        font-size: 0.95rem;
      }
      .giris-ekrani {
        padding: 20px 25px;
      }
      .baslik {
        font-size: 1.6rem;
      }
      .canvas-container {
        width: 370px; /* Telefon iÃ§in Ã§ark boyutunu ayarladÄ±k */
        height: 370px;
      }
      /* OK Ä°ÅARETÄ° DÃœZELTMESÄ° (Mobil) */
      #okIsareti {
        --ok-yatay-boyut: 10px;
        --ok-dikey-boyut: 25px;
      }
      .canvas-button {
        width: 120px; /* Telefon iÃ§in Ã§evir butonu */
        height: 120px;
        line-height: 120px;
        font-size: 1.5rem;
      }
      /* Grup tablosu iÃ§in 2x2 dÃ¼zen (Mobil) */
      .grup-tablosu {
        flex-direction: row; /* Yan yana hizalama */
        justify-content: center; /* Ortala */
        align-items: flex-start; /* Ãœste hizala */
        gap: 10px; /* AralarÄ±ndaki boÅŸluÄŸu koru */
      }
      .grup {
        min-width: unset; /* Minimum geniÅŸliÄŸi kaldÄ±r */
        width: calc(50% - 10px); /* 2x2 dÃ¼zen iÃ§in geniÅŸlik ayarÄ± (boÅŸluk dahil) */
        padding: 10px;
        box-sizing: border-box; /* Padding'i geniÅŸliÄŸe dahil et */
      }
      .grup .isim {
        font-size: 1rem;
      }
      .grup .puan {
        font-size: 1.4rem;
      }
      .ust-bilgi-kutusu {
        gap: 3px;
        font-size: 0.85rem;
      }
      .ust-bilgi {
        padding: 5px 8px;
      }
      .soru-kutusu {
        padding: 20px;
      }
      .soru-metin {
        font-size: 1.1rem;
      }
      .secenek-btn {
        padding: 10px 12px;
        font-size: 0.95rem;
      }
      .puan-tablosu th, .puan-tablosu td {
        padding: 8px 10px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <div id="appContainer">
    <div class="giris-ekrani" id="girisEkrani">
      <h1 class="baslik">ğŸ¡ Bilgi YarÄ±ÅŸmasÄ±na HoÅŸgeldiniz!</h1>
      <form id="teamForm" class="grup-formu">
        <label for="numGroups">Grup SayÄ±sÄ±:</label>
        <select id="numGroups" name="numGroups" class="grup-formu-input">
          <option value="1">1 Grup</option>
          <option value="2">2 Grup</option>
          <option value="3">3 Grup</option>
          <option value="4" selected>4 Grup</option>
        </select>
        <div id="teamNameInputs">
          </div>
        <button type="submit" class="basla-butonu">Oyunu BaÅŸlat</button>
      </form>
    </div>

    <div class="tam-ekran-kapsayici" id="carkEkrani" style="display:none;">
      <div id="ayetKutusu" class="ayet"></div>
      <div class="canvas-container">
        <div id="okIsareti"></div>
        <canvas id="wheelCanvas" width="550" height="550"></canvas>
        <button id="spinButton" class="canvas-button">Ã‡EVÄ°R</button>
      </div>
      <div id="aktifGrupKutusu" class="aktif-grup-box">SÄ±ra: GRUP 1</div>
      <div class="grup-tablosu" id="grupTablosuCark">
        </div>
      <button id="endGameButton" class="basla-butonu" style="margin-top: 30px;">Oyunu Bitir</button>
    </div>

    <div class="tam-ekran-kapsayici" id="soruSayfasi" style="display:none;">
      <div class="ust-bilgi-kutusu">
        <div id="aktifGrup" class="ust-bilgi sol-kose">SÄ±ra: ...</div>
        <div id="incomingPoints" class="ust-bilgi orta-kose">Puan: 0</div>
        <div class="ust-bilgi sag-kose">SÃ¼re: <span id="time">30</span> sn</div>
      </div>
      <div id="questionBox" class="soru-kutusu">
        <p class="soru-metin">Soru yÃ¼kleniyor...</p>
        <div id="optionsContainer" class="secenek-kutusu"></div>
        <div id="messageBox" class="message-box" style="display:none;"></div>
        <div class="joker-button-container">
            <button id="fiftyFiftyJokerBtn" class="joker-button" disabled>50/50 Joker</button>
            <button id="doubleAnswerJokerBtn" class="joker-button" disabled>Ã‡ift Cevap Joker</button>
        </div>
      </div>
    </div>

    <div class="oyun-bitti-ekran" id="finalEkrani" style="display:none;">
      <h1 id="baslikKutusu" class="baslik">ğŸ‰ Oyun Bitti!</h1>
      <table class="puan-tablosu">
        <thead>
          <tr>
            <th>Grup</th>
            <th>Puan</th>
          </tr>
        </thead>
        <tbody id="puanlarAlani">
          </tbody>
      </table>
      <button onclick="anaEkranaDon()" class="ana-butonu">Ana Ekrana DÃ¶n</button>
    </div>
  </div>

  <script>
    // ------------------------------------- //
    //           GLOBAL OYUN DEÄÄ°ÅKENLERÄ°    //
    // ------------------------------------- //
    let teams = [];
    let currentTeamIndex = 0;
    let usedQuestions = [];
    let currentQuestion = null;
    let incomingPointsValue = 0;
    let scoreMultiplier = 1;
    let timerInterval;
    let selectedOptionIndex = -1;
    let selectedDoubleAnswers = [];

    // Joker durumlarÄ± (her soru iÃ§in sÄ±fÄ±rlanÄ±r)
    let isDoubleAnswerActiveForQuestion = false;
    let isFiftyFiftyActiveForQuestion = false;

    // ------------------------------------- //
    //           HTML ELEMENTLERE ERÄ°ÅÄ°M     //
    // ------------------------------------- //
    const numGroupsSelect = document.getElementById('numGroups');
    const teamNameInputsDiv = document.getElementById('teamNameInputs');
    const wheelCanvas = document.getElementById('wheelCanvas');
    const ctx = wheelCanvas.getContext('2d');
    const spinButton = document.getElementById('spinButton');
    const okIsareti = document.getElementById('okIsareti');
    const questionTextElement = document.querySelector('#questionBox .soru-metin');
    const optionsContainer = document.getElementById('optionsContainer');
    const aktifGrupHeader = document.getElementById('aktifGrup');
    const incomingPointsHeader = document.getElementById('incomingPoints');
    const timeElement = document.getElementById('time');
    const messageBox = document.getElementById('messageBox');
    const fiftyFiftyJokerBtn = document.getElementById('fiftyFiftyJokerBtn');
    const doubleAnswerJokerBtn = document.getElementById('doubleAnswerJokerBtn');
    const questionBox = document.getElementById('questionBox');
    const ayetKutusu = document.getElementById('ayetKutusu'); // Ayet kutusu elementini ekledik

    // ------------------------------------- //
    //           OYUN VERÄ°LERÄ° (Ã‡ark Segmentleri ve Sorular)    //
    // ------------------------------------- //
    const pointMap = [
      { id: 0, type: "normal", points: 10, label: "10 PUAN", color: "#A3CEF1" },
      { id: 1, type: "ceza", label: "PAS", color: "#A29CFF" },
      { id: 2, type: "normal", points: 20, label: "20 PUAN", color: "#FFE156" },
      { id: 3, type: "ceza", label: "Ä°FLAS", color: "#FF6B6B" },
      { id: 4, type: "normal", points: 30, label: "30 PUAN", color: "#FFD6A5" },
      { id: 5, type: "joker", label: "JOKER", color: "#BDE0FE" },
      { id: 6, type: "normal", points: 40, label: "40 PUAN", color: "#FDFFB6" },
      { id: 7, type: "normal", points: 50, label: "50 PUAN", color: "#FFABAB" },
      { id: 8, type: "bonus", label: "PUANINI KATLA", color: "#4ECDC4" },
      { id: 9, type: "normal", points: 60, label: "60 PUAN", color: "#FFC1CC" },
      { id: 10, type: "bonus", label: "TEKRAR DÃ–NDÃœR", color: "#88D498" },
      { id: 11, type: "normal", points: 70, label: "70 PUAN", color: "#D3F8E2" },
      { id: 12, type: "joker", label: "JOKER", color: "#8FBCBB" },
      { id: 13, type: "normal", points: 80, label: "80 PUAN", color: "#C6E2E9" },
      { id: 14, type: "ceza", label: "PAS", color: "#A29CFF" },
      { id: 15, type: "normal", points: 90, label: "90 PUAN", color: "#FFDDE2" }
    ];

    const questions = [
      {
        question: "Ä°slam'Ä±n ilk ÅŸartÄ± nedir?",
        options: ["OruÃ§", "Zekat", "Åehadet", "Namaz"],
        answer: 2,
        explanation: "Ä°slam'Ä±n ilk ÅŸartÄ± Allahâ€™a ve Peygamberâ€™e iman etmektir."
      },
      {
        question: "Kur'an-Ä± Kerim kaÃ§ sureden oluÅŸur?",
        options: ["110", "112", "113", "114"],
        answer: 3,
        explanation: "Kurâ€™an-Ä± Kerim'de 114 sure vardÄ±r."
      },
      {
        question: "Hz. Muhammed'in doÄŸum yeri neresidir?",
        options: ["Medine", "Mekke", "KudÃ¼s", "Taif"],
        answer: 1,
        explanation: "Peygamberimiz Mekke'de doÄŸmuÅŸtur."
      },
      {
        question: "Ä°slam'Ä±n beÅŸ ÅŸartÄ±ndan biri deÄŸildir:",
        options: ["Namaz", "OruÃ§", "Sadaka", "Hac"],
        answer: 2,
        explanation: "Sadaka, farz deÄŸil; ancak hayÄ±rlÄ± bir davranÄ±ÅŸtÄ±r."
      },
      {
        question: "ZekÃ¢t kimlere verilir?",
        options: ["Zenginlere", "Yoksullara", "Akrabalara", "KomÅŸulara"],
        answer: 1,
        explanation: "ZekÃ¢t, malÄ± olmayan yoksullara verilir."
      },
      {
        question: "Hac ibadeti hangi ayda yapÄ±lÄ±r?",
        options: ["Ramazan", "Zilhicce", "Muharrem", "Recep"],
        answer: 1,
        explanation: "Hac, Zilhicce ayÄ±nda yapÄ±lÄ±r."
      },
      {
        question: "Kurâ€™an-Ä± Kerim'de ilk indirilen ayet hangi suredendir?",
        options: ["Fatiha", "Alak", "Bakara", "Yasin"],
        answer: 1,
        explanation: "Kur'an-Ä± Kerim'de ilk indirilen ayet Alak Suresi'nin ilk beÅŸ ayetidir."
      },
      {
        question: "Namazda kÄ±ble ne yÃ¶ndedir?",
        options: ["DoÄŸu", "KÃ¢be", "KudÃ¼s", "BatÄ±"],
        answer: 1,
        explanation: "Namazda kÄ±ble, Mekke'deki KÃ¢be yÃ¶nÃ¼ndedir."
      },
      {
        question: "Ä°slam'Ä±n ikinci ÅŸartÄ± nedir?",
        options: ["Namaz", "Zekat", "OruÃ§", "Hac"],
        answer: 0,
        explanation: "Ä°slam'Ä±n ikinci ÅŸartÄ± namaz kÄ±lmaktÄ±r."
      },
      {
        question: "Kuran-Ä± Kerim kaÃ§ yÄ±lda indirilmiÅŸtir?",
        options: ["13", "23", "33", "40"],
        answer: 1,
        explanation: "Kuran-Ä± Kerim yaklaÅŸÄ±k 23 yÄ±lda parÃ§a parÃ§a indirilmiÅŸtir."
      },
      {
        question: "Hz. Muhammed'in (s.a.v.) babasÄ±nÄ±n adÄ± nedir?",
        options: ["Ebu Talib", "Abdullah", "Hamza", "Ã–mer"],
        answer: 1,
        explanation: "Peygamber Efendimiz'in babasÄ±nÄ±n adÄ± Abdullah'tÄ±r."
      },
      {
        question: "Ä°slam takvimine gÃ¶re ilk ay hangisidir?",
        options: ["Ramazan", "Åevval", "Muharrem", "Recep"],
        answer: 2,
        explanation: "Ä°slam takviminin ilk ayÄ± Muharrem ayÄ±dÄ±r."
      },
      {
        question: "OruÃ§ ibadeti hangi ayda yerine getirilir?",
        options: ["Zilhicce", "Åaban", "Ramazan", "Recep"],
        answer: 2,
        explanation: "OruÃ§ ibadeti Ramazan ayÄ±nda yerine getirilir."
      },
      {
        question: "Peygamber Efendimiz'e vahiy getiren meleÄŸin adÄ± nedir?",
        options: ["Mikail", "Ä°srafil", "Azrail", "Cebrail"],
        answer: 3,
        explanation: "Peygamberimize vahiy getiren melek Cebrail (a.s.)'dÄ±r."
      },
      {
        question: "Kuran-Ä± Kerim'de adÄ± geÃ§en tek kadÄ±n kimdir?",
        options: ["AyÅŸe", "FatÄ±ma", "Meryem", "Hatice"],
        answer: 2,
        explanation: "Kuran-Ä± Kerim'de adÄ± geÃ§en tek kadÄ±n Hz. Meryem'dir."
      },
      {
        question: "Veda Hutbesi nerede okunmuÅŸtur?",
        options: ["Mekke", "Medine", "Arafat", "KudÃ¼s"],
        answer: 2,
        explanation: "Peygamber Efendimiz Veda Hutbesi'ni Arafat'ta okumuÅŸtur."
      },
      {
        question: "Ä°slam'da zekat oranÄ± genellikle yÃ¼zde kaÃ§tÄ±r?",
        options: ["%1", "%2.5", "%5", "%10"],
        answer: 1,
        explanation: "Zekat oranÄ± genellikle %2.5 veya 1/40'tÄ±r."
      },
      {
        question: "Hicret olayÄ± hangi ÅŸehirler arasÄ±nda gerÃ§ekleÅŸmiÅŸtir?",
        options: ["Mekke-KudÃ¼s", "Medine-Åam", "Mekke-Medine", "Taif-Medine"],
        answer: 2,
        explanation: "Hicret, Mekke'den Medine'ye gerÃ§ekleÅŸmiÅŸtir."
      },
      {
        question: "Kuran-Ä± Kerim'in ilk suresi hangisidir?",
        options: ["Bakara", "Fatiha", "Ä°hlas", "Nas"],
        answer: 1,
        explanation: "Kuran-Ä± Kerim'in ilk suresi Fatiha Suresi'dir."
      },
      {
        question: "Namazda 'SÃ¼bhane Rabbiyel Azim' hangi rÃ¼kunda sÃ¶ylenir?",
        options: ["RÃ¼ku", "Secde", "KÄ±yam", "Kade"],
        answer: 0,
        explanation: "RÃ¼kuda 'SÃ¼bhane Rabbiyel Azim' denir."
      }
    ];

    // ------------------------------------- //
    //           SAYFA YÃ–NETÄ°MÄ° VE YÃœKLEME   //
    // ------------------------------------- //

    // Sayfa deÄŸiÅŸtirme fonksiyonu
    function showPage(pageId) {
      document.getElementById('girisEkrani').style.display = 'none';
      document.getElementById('carkEkrani').style.display = 'none';
      document.getElementById('soruSayfasi').style.display = 'none';
      document.getElementById('finalEkrani').style.display = 'none';

      const targetPage = document.getElementById(pageId);
      if (targetPage) {
        if (targetPage.classList.contains('tam-ekran-kapsayici')) {
          targetPage.style.display = 'flex';
        } else {
          targetPage.style.display = 'block';
        }
      }

      // Sayfa Ã¶zel baÅŸlatma
      if (pageId === 'carkEkrani') {
        initializeWheelPage();
      } else if (pageId === 'soruSayfasi') {
        initializeQuestionPage();
      } else if (pageId === 'finalEkrani') {
        initializeFinalPage();
      }
    }

    // Ana ekrana dÃ¶nme ve oyunu sÄ±fÄ±rlama
    function anaEkranaDon() {
        localStorage.clear();
        teams = [];
        currentTeamIndex = 0;
        usedQuestions = [];
        currentQuestion = null;
        incomingPointsValue = 0;
        scoreMultiplier = 1;
        clearInterval(timerInterval);

        showPage('girisEkrani');
        generateTeamInputs(); // Yeni oyun iÃ§in inputlarÄ± sÄ±fÄ±rla
    }

    // Sayfa yÃ¼klendiÄŸinde giriÅŸ ekranÄ±nÄ± gÃ¶ster ve inputlarÄ± oluÅŸtur
    document.addEventListener('DOMContentLoaded', () => {
        showPage('girisEkrani');
        generateTeamInputs();
    });

    // ------------------------------------- //
    //           GÄ°RÄ°Å EKRANI Ä°ÅLEVLERÄ°      //
    // ------------------------------------- //

    // Grup sayÄ±sÄ± deÄŸiÅŸtikÃ§e inputlarÄ± oluÅŸtur
    function generateTeamInputs() {
      const numGroups = parseInt(numGroupsSelect.value);
      teamNameInputsDiv.innerHTML = '';
      for (let i = 1; i <= numGroups; i++) {
        const label = document.createElement('label');
        label.innerHTML = `Grup ${i} AdÄ±: <input type="text" name="grup${i}" required value="Grup ${i}" />`;
        teamNameInputsDiv.appendChild(label);
      }
    }

    // Form gÃ¶nderildiÄŸinde takÄ±mlarÄ± kaydet ve Ã§ark ekranÄ±na geÃ§
    document.getElementById("teamForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const numGroups = parseInt(numGroupsSelect.value);
      const newTeams = [];
      for (let i = 1; i <= numGroups; i++) {
        const input = document.querySelector(`input[name="grup${i}"]`);
        newTeams.push({
            name: input.value.trim(),
            score: 0,
            hasFiftyFiftyJoker: false,
            hasDoubleAnswerJoker: false
        });
      }

      localStorage.setItem("teams", JSON.stringify(newTeams));
      localStorage.setItem("currentTeam", 0);
      localStorage.setItem("usedQuestions", JSON.stringify([]));
      localStorage.setItem("incomingPoints", 0);
      localStorage.setItem("scoreMultiplier", 1);

      showPage('carkEkrani');
    });

    // ------------------------------------- //
    //           Ã‡ARK EKRANI Ä°ÅLEVLERÄ°       //
    // ------------------------------------- //

    const totalSegments = pointMap.length;
    const segmentAngle = (2 * Math.PI) / totalSegments;
    let rotation = 0;
    let spinning = false;
    let currentTargetSegmentIndex = -1;

    // Ã‡arkÄ± Ã§izme fonksiyonu
    function drawWheel() {
      ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
      const centerX = wheelCanvas.width / 2;
      const centerY = wheelCanvas.height / 2;
      const radius = wheelCanvas.width / 2;

      for (let i = 0; i < totalSegments; i++) {
        const startAngle = i * segmentAngle + rotation;
        const endAngle = (i + 1) * segmentAngle + rotation;
        const segment = pointMap[i];

        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, startAngle, endAngle);
        ctx.lineTo(centerX, centerY);
        ctx.closePath();
        ctx.fillStyle = segment.color;
        ctx.fill();
        ctx.strokeStyle = '#ffffff';
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.save();
        ctx.translate(centerX, centerY);
        ctx.rotate(startAngle + segmentAngle / 2);
        ctx.fillStyle = '#1a202c';
        ctx.font = '20px Segoe UI';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(segment.label, radius * 0.7, 0); // YazÄ±nÄ±n konumu
        ctx.restore();
      }
    }

    // Ã‡arkÄ± dÃ¶ndÃ¼rme animasyonu
    function spinWheel() {
      if (spinning) return;
      spinning = true;
      spinButton.disabled = true;
      okIsareti.classList.remove('titre');

      const minRevolutions = 3;
      const maxRevolutions = 7;

      currentTargetSegmentIndex = Math.floor(Math.random() * totalSegments);

      const arrowReferenceAngle = (3 * Math.PI / 2);
      const targetSegmentCenterAngle = (currentTargetSegmentIndex * segmentAngle) + (segmentAngle / 2);
      let rotationNeeded = (arrowReferenceAngle - targetSegmentCenterAngle + (2 * Math.PI)) % (2 * Math.PI);
      const finalAngle = (minRevolutions * 2 * Math.PI) + rotationNeeded;

      const duration = 4000;
      const startTime = performance.now();

      function animateSpin(currentTime) {
        const elapsedTime = currentTime - startTime;
        const progress = Math.min(elapsedTime / duration, 1);
        const easeOutQuad = progress * (2 - progress);

        rotation = (finalAngle * easeOutQuad) % (2 * Math.PI);
        drawWheel();

        if (progress < 1) {
          requestAnimationFrame(animateSpin);
        } else {
          spinning = false;
          spinButton.disabled = false;
          okIsareti.classList.add('titre');
          handleSpinResult(currentTargetSegmentIndex);
        }
      }
      requestAnimationFrame(animateSpin);
    }

    // Ã‡ark dÃ¶nÃ¼ÅŸ sonucunu yÃ¶netme
    function handleSpinResult(segmentIndex) {
      const result = pointMap[segmentIndex];
      const currentTeam = teams[currentTeamIndex];

      incomingPointsValue = 0;
      scoreMultiplier = 1;
      isDoubleAnswerActiveForQuestion = false;
      isFiftyFiftyActiveForQuestion = false;

      switch (result.type) {
        case "normal":
          incomingPointsValue = result.points;
          localStorage.setItem("incomingPoints", incomingPointsValue);
          localStorage.setItem("scoreMultiplier", scoreMultiplier);
          showPage('soruSayfasi');
          break;
        case "bonus":
          if (result.label === "TEKRAR DÃ–NDÃœR") {
            alert(`${currentTeam.name}: Tekrar DÃ¶ndÃ¼r! Bir daha Ã§ark Ã§evirme hakkÄ± kazandÄ±nÄ±z.`);
            spinButton.disabled = false;
          } else if (result.label === "PUANINI KATLA") {
            incomingPointsValue = currentTeam.score; // Mevcut puanÄ± gelen puan olarak al
            scoreMultiplier = 2; // Bu puanÄ± ikiye katla
            localStorage.setItem("incomingPoints", incomingPointsValue);
            localStorage.setItem("scoreMultiplier", scoreMultiplier);
            alert(`${currentTeam.name}: PuanÄ±nÄ± Katla! Bu soruyu bilirseniz mevcut ${currentTeam.score} puanÄ±nÄ±z iki katÄ±na Ã§Ä±kacak!`);
            showPage('soruSayfasi');
          }
          break;
        case "joker":
            assignRandomJokerToCurrentTeam();
            alert(`${currentTeam.name}: Joker KazandÄ±nÄ±z!`);
            nextTurn(); // Joker verildi, sÄ±ra diÄŸer gruba geÃ§er
            showPage('carkEkrani');
            break;
        case "ceza":
          if (result.label === "Ä°FLAS") {
            currentTeam.score = 0;
            updateGroupScoresInLocalStorage();
            alert(`${currentTeam.name}: Ä°flas! TÃ¼m puanlarÄ±nÄ±z sÄ±fÄ±rlandÄ±.`);
            nextTurn();
            showPage('carkEkrani');
          } else if (result.label === "PAS") {
            alert(`${currentTeam.name}: Pas! SÄ±ra diÄŸer gruba geÃ§ti.`);
            nextTurn();
            showPage('carkEkrani');
          }
          break;
      }
    }

    // Rastgele joker atama
    function assignRandomJokerToCurrentTeam() {
        const currentTeam = teams[currentTeamIndex];
        const availableJokers = [];
        if (!currentTeam.hasFiftyFiftyJoker) {
            availableJokers.push("50/50");
        }
        if (!currentTeam.hasDoubleAnswerJoker) {
            availableJokers.push("Ã‡ift Cevap");
        }

        if (availableJokers.length === 0) {
            alert("Zaten tÃ¼m joker haklarÄ±nÄ±z var!");
            return;
        }

        const randomIndex = Math.floor(Math.random() * availableJokers.length);
        const assignedJoker = availableJokers[randomIndex];

        if (assignedJoker === "50/50") {
            currentTeam.hasFiftyFiftyJoker = true;
        } else if (assignedJoker === "Ã‡ift Cevap") {
            currentTeam.hasDoubleAnswerJoker = true;
        }
        updateGroupScoresInLocalStorage();
    }

    // Ã‡arkÄ± dÃ¶ndÃ¼rme butonu dinleyicisi
    spinButton.addEventListener('click', spinWheel);

    // Ã‡ark ekranÄ±nÄ± baÅŸlatma (sayfa geÃ§iÅŸinde Ã§aÄŸrÄ±lÄ±r)
    function initializeWheelPage() {
      teams = JSON.parse(localStorage.getItem("teams")) || [];
      currentTeamIndex = parseInt(localStorage.getItem("currentTeam") || "0");
      usedQuestions = JSON.parse(localStorage.getItem("usedQuestions")) || [];
      incomingPointsValue = parseInt(localStorage.getItem("incomingPoints") || "0");
      scoreMultiplier = parseInt(localStorage.getItem("scoreMultiplier") || "1");

      if (teams.length === 0) {
        showPage('girisEkrani');
        return;
      }
      drawWheel();
      updateGroupScoresDisplay();
      updateCurrentTeamDisplay();
      displayRandomAyat(); // Ayeti gÃ¶ster

      // Oyunu bitir butonu
      document.getElementById("endGameButton").addEventListener("click", () => {
          showPage("finalEkrani");
      });
    }

    // Rastgele ayet gÃ¶sterme
    function displayRandomAyat() {
        const ayetler = [
            "De ki: 'O Allah birdir.' (Ä°hlas Suresi, 1)",
            "GerÃ§ekten, zorlukla beraber bir kolaylÄ±k vardÄ±r. (Ä°nÅŸirah Suresi, 5)",
            "Rabbinin nimetini anlat da anlat. (Duha Suresi, 11)",
            "ÅÃ¼phesiz Allah, sabredenlerle beraberdir. (Bakara Suresi, 153)",
            "Her can Ã¶lÃ¼mÃ¼ tadacaktÄ±r. (Al-i Ä°mran Suresi, 185)",
            "Allah, her ÅŸeyi hakkÄ±yla bilendir. (Bakara Suresi, 282)",
            "DoÄŸrusu insan iÃ§in kendi Ã§alÄ±ÅŸmasÄ±ndan baÅŸka bir ÅŸey yoktur. (Necm Suresi, 39)"
        ];
        const randomIndex = Math.floor(Math.random() * ayetler.length);
        ayetKutusu.textContent = ayetler[randomIndex];
    }

    // Grup puanlarÄ±nÄ± gÃ¼ncelleme (gÃ¶rsel)
    function updateGroupScoresDisplay() {
      const grupTablosu = document.getElementById('grupTablosuCark');
      grupTablosu.innerHTML = '';
      teams.forEach((team, index) => {
        const grupDiv = document.createElement('div');
        grupDiv.classList.add('grup');
        if (index === currentTeamIndex) {
          grupDiv.style.border = '2px solid #319795';
        }
        grupDiv.innerHTML = `<div class="isim">${team.name}</div>
                             <div class="puan">${team.score}</div>
                             ${team.hasFiftyFiftyJoker ? '<span title="50/50 Jokeriniz Var">ğŸƒ</span>' : ''}
                             ${team.hasDoubleAnswerJoker ? '<span title="Ã‡ift Cevap Jokeriniz Var">âœŒï¸</span>' : ''}`;
        grupTablosu.appendChild(grupDiv);
      });
    }

    // Aktif grubu gÃ¼ncelleme (gÃ¶rsel)
    function updateCurrentTeamDisplay() {
      const aktifGrupKutusu = document.getElementById('aktifGrupKutusu');
      aktifGrupKutusu.textContent = `SÄ±ra: ${teams[currentTeamIndex].name}`;
    }

    // SÄ±rayÄ± bir sonraki gruba geÃ§irme
    function nextTurn() {
      currentTeamIndex = (currentTeamIndex + 1) % teams.length;
      localStorage.setItem("currentTeam", currentTeamIndex);
      localStorage.setItem("incomingPoints", 0);
      localStorage.setItem("scoreMultiplier", 1);
    }

    // Local Storage'daki grup skorlarÄ±nÄ± gÃ¼ncelleme
    function updateGroupScoresInLocalStorage() {
      localStorage.setItem("teams", JSON.stringify(teams));
    }


    // ------------------------------------- //
    //           SORU SAYFASI Ä°ÅLEVLERÄ°      //
    // ------------------------------------- //

    let timeLeft = 30; // Her soru iÃ§in sÃ¼re

    // Soru sayfasÄ±nÄ± baÅŸlatma (sayfa geÃ§iÅŸinde Ã§aÄŸrÄ±lÄ±r)
    function initializeQuestionPage() {
      teams = JSON.parse(localStorage.getItem("teams")) || [];
      currentTeamIndex = parseInt(localStorage.getItem("currentTeam") || "0");
      usedQuestions = JSON.parse(localStorage.getItem("usedQuestions")) || [];
      incomingPointsValue = parseInt(localStorage.getItem("incomingPoints") || "0");
      scoreMultiplier = parseInt(localStorage.getItem("scoreMultiplier") || "1");

      // Joker ve seÃ§im durumlarÄ±nÄ± sÄ±fÄ±rla
      isDoubleAnswerActiveForQuestion = false;
      isFiftyFiftyActiveForQuestion = false;
      selectedDoubleAnswers = [];
      selectedOptionIndex = -1;

      if (teams.length === 0) {
        showPage('girisEkrani');
        return;
      }

      aktifGrupHeader.textContent = `SÄ±ra: ${teams[currentTeamIndex].name}`;
      incomingPointsHeader.textContent = `Puan: ${incomingPointsValue * scoreMultiplier}`;
      messageBox.style.display = 'none';

      setupJokerButtons();
      loadQuestion();
      startTimer();
    }

    // Joker butonlarÄ±nÄ± ayarlama
    function setupJokerButtons() {
        const currentTeam = teams[currentTeamIndex];

        fiftyFiftyJokerBtn.disabled = !currentTeam.hasFiftyFiftyJoker;
        fiftyFiftyJokerBtn.onclick = currentTeam.hasFiftyFiftyJoker ? () => activateFiftyFiftyJoker() : null;

        doubleAnswerJokerBtn.disabled = !currentTeam.hasDoubleAnswerJoker;
        doubleAnswerJokerBtn.onclick = currentTeam.hasDoubleAnswerJoker ? () => activateDoubleAnswerJoker() : null;
    }

    // 50/50 jokerini aktifleÅŸtirme
    function activateFiftyFiftyJoker() {
        if (!teams[currentTeamIndex].hasFiftyFiftyJoker) return;

        isFiftyFiftyActiveForQuestion = true;
        teams[currentTeamIndex].hasFiftyFiftyJoker = false;
        updateGroupScoresInLocalStorage();
        setupJokerButtons();

        applyFiftyFifty();
        messageBox.textContent = "50/50 Joker kullanÄ±ldÄ±! Ä°ki yanlÄ±ÅŸ ÅŸÄ±k elendi.";
        messageBox.style.display = 'block';
    }

    // Ã‡ift Cevap jokerini aktifleÅŸtirme
    function activateDoubleAnswerJoker() {
        if (!teams[currentTeamIndex].hasDoubleAnswerJoker) return;

        isDoubleAnswerActiveForQuestion = true;
        teams[currentTeamIndex].hasDoubleAnswerJoker = false;
        updateGroupScoresInLocalStorage();
        setupJokerButtons();

        messageBox.textContent = "Ã‡ift Cevap aktif! Ä°ki ÅŸÄ±k seÃ§ebilirsiniz.";
        messageBox.style.display = 'block';
    }

    // Soru yÃ¼kleme
    function loadQuestion() {
      if (usedQuestions.length === questions.length) {
        alert("TÃ¼m sorular bitti! Oyun sona eriyor.");
        showPage('finalEkrani');
        return;
      }

      let availableQuestions = questions.filter((_, index) => !usedQuestions.includes(index));
      if (availableQuestions.length === 0) {
          alert("TÃ¼m sorular kullanÄ±lmÄ±ÅŸ. Yeni bir oyun baÅŸlatÄ±n.");
          showPage('finalEkrani');
          return;
      }

      const randomIndex = Math.floor(Math.random() * availableQuestions.length);
      currentQuestion = availableQuestions[randomIndex];
      const questionIndex = questions.indexOf(currentQuestion);
      usedQuestions.push(questionIndex);
      localStorage.setItem("usedQuestions", JSON.stringify(usedQuestions));

      const oldResultBox = questionBox.querySelector('.sonuc-kutusu');
      if (oldResultBox) {
          oldResultBox.remove();
      }

      questionTextElement.textContent = currentQuestion.question;
      optionsContainer.innerHTML = '';
      selectedOptionIndex = -1;
      selectedDoubleAnswers = [];

      currentQuestion.options.forEach((option, index) => {
        const button = document.createElement('button');
        button.classList.add('secenek-btn');
        button.textContent = option;
        button.dataset.index = index;
        button.addEventListener('click', () => handleOptionClick(index, button));
        optionsContainer.appendChild(button);
      });
    }

    // 50/50 jokerini uygulama
    function applyFiftyFifty() {
        const incorrectOptions = [];
        for (let i = 0; i < currentQuestion.options.length; i++) {
            if (i !== currentQuestion.answer) {
                incorrectOptions.push(i);
            }
        }

        const disabledIndexes = [];
        const numToDisable = Math.min(2, incorrectOptions.length);

        while (disabledIndexes.length < numToDisable) {
            const randomIndex = Math.floor(Math.random() * incorrectOptions.length);
            disabledIndexes.push(incorrectOptions.splice(randomIndex, 1)[0]);
        }

        const optionButtons = optionsContainer.querySelectorAll('.secenek-btn');
        disabledIndexes.forEach(index => {
            optionButtons[index].classList.add('disabled');
            optionButtons[index].disabled = true;
        });
    }

    // ÅÄ±k seÃ§imi yÃ¶netimi
    function handleOptionClick(index, button) {
        if (isDoubleAnswerActiveForQuestion) {
            if (button.classList.contains('disabled')) {
                return;
            }

            if (button.classList.contains('selected-option')) {
                button.classList.remove('selected-option');
                selectedDoubleAnswers = selectedDoubleAnswers.filter(i => i !== index);
            } else {
                if (selectedDoubleAnswers.length < 2) {
                    button.classList.add('selected-option');
                    selectedDoubleAnswers.push(index);
                } else {
                    alert("Ã‡ift Cevap hakkÄ±nÄ±zla sadece iki ÅŸÄ±k seÃ§ebilirsiniz.");
                }
            }

            if (selectedDoubleAnswers.length === 2) {
                checkAnswer(selectedDoubleAnswers);
            }

        } else {
            selectedOptionIndex = index;
            checkAnswer(index);
        }
    }

    // CevabÄ± kontrol etme
    function checkAnswer(chosenValue) {
      clearInterval(timerInterval);

      let isCorrect = false;
      let finalPoints = 0;

      const optionButtons = optionsContainer.querySelectorAll('.secenek-btn');
      optionButtons.forEach(btn => btn.disabled = true);
      fiftyFiftyJokerBtn.disabled = true;
      doubleAnswerJokerBtn.disabled = true;

      if (isDoubleAnswerActiveForQuestion) {
          if (Array.isArray(chosenValue) && chosenValue.length > 0) {
              isCorrect = chosenValue.includes(currentQuestion.answer);
          } else {
              isCorrect = false;
          }
      } else {
          isCorrect = (chosenValue === currentQuestion.answer);
      }

      if (isCorrect) {
        finalPoints = incomingPointsValue * scoreMultiplier;
        teams[currentTeamIndex].score += finalPoints;
        updateGroupScoresInLocalStorage();
        displayResult(true, finalPoints);
      } else {
        displayResult(false);
      }

      optionButtons.forEach((button, index) => {
        if (index === currentQuestion.answer) {
          button.classList.add('correct-answer');
        } else {
          if ((isDoubleAnswerActiveForQuestion && Array.isArray(chosenValue) && chosenValue.includes(index) && !isCorrect) ||
              (!isDoubleAnswerActiveForQuestion && chosenValue === index && !isCorrect)) {
              button.classList.add('incorrect-answer');
          }
        }
      });

      localStorage.setItem("scoreMultiplier", 1); // Ã‡arpanÄ± sÄ±fÄ±rla

      setTimeout(() => {
        if (usedQuestions.length === questions.length) {
            showPage('finalEkrani');
        } else {
            nextTurn();
            showPage('carkEkrani');
        }
      }, 4000);
    }

    // SÃ¼reyi baÅŸlatma
    function startTimer() {
      timeLeft = 30;
      timeElement.textContent = timeLeft;
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft--;
        timeElement.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          alert("SÃ¼re doldu! Cevap veremediniz.");
          const finalSubmission = isDoubleAnswerActiveForQuestion ? selectedDoubleAnswers : -1;
          checkAnswer(finalSubmission);
        }
      }, 1000);
    }

    // Sonucu gÃ¶sterme kutusu
    function displayResult(isCorrect, pointsAwarded = 0) {
      const resultBox = document.createElement('div');
      resultBox.classList.add('sonuc-kutusu');
      questionBox.appendChild(resultBox);

      if (isCorrect) {
        resultBox.classList.add('dogru');
        resultBox.innerHTML = `<h3>DoÄŸru Cevap! ğŸ‰</h3><p>${pointsAwarded} puan kazandÄ±nÄ±z.</p><p>AÃ§Ä±klama: ${currentQuestion.explanation}</p>`;
      } else {
        resultBox.classList.add('yanlis');
        resultBox.innerHTML = `<h3>YanlÄ±ÅŸ Cevap! ğŸ˜”</h3><p>DoÄŸru cevap: "${currentQuestion.options[currentQuestion.answer]}".</p><p>AÃ§Ä±klama: ${currentQuestion.explanation}</p>`;
      }
    }


    // ------------------------------------- //
    //           OYUN BÄ°TTÄ° EKRANI Ä°ÅLEVLERÄ° //
    // ------------------------------------- //

    // Final sayfasÄ±nÄ± baÅŸlatma
    function initializeFinalPage() {
      teams = JSON.parse(localStorage.getItem("teams")) || [];
      const puanlarAlani = document.getElementById('puanlarAlani');
      puanlarAlani.innerHTML = '';

      teams.sort((a, b) => b.score - a.score); // Puanlara gÃ¶re sÄ±rala

      teams.forEach(team => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${team.name}</td><td>${team.score}</td>`;
        puanlarAlani.appendChild(row);
      });

      const baslikKutusu = document.getElementById('baslikKutusu');
      if (teams.length > 0) {
        baslikKutusu.textContent = `ğŸ‰ Oyun Bitti! Kazanan: ${teams[0].name}`;
      } else {
        baslikKutusu.textContent = `ğŸ‰ Oyun Bitti!`;
      }
    }
  </script>
</body>
</html>
